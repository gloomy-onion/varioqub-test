<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>Varioqub + –ú–µ—Ç—Ä–∏–∫–∞ —Ç–µ—Å—Ç</title>

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
      (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
      })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105672115', 'ym');

      ym(105672115, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/105672115" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->

    <!-- Varioqub experiments -->
    <script type="text/javascript">
      (function(e, x, pe, r, i, me, nt){
        e[i]=e[i]||function(){(e[i].a=e[i].a||[]).push(arguments)},
          me=x.createElement(pe),me.async=1,me.src=r,nt=x.getElementsByTagName(pe)[0],me.addEventListener('error',function(){function cb(t){t=t[t.length-1],'function'==typeof t&&t({flags:{}})};Array.isArray(e[i].a)&&e[i].a.forEach(cb);e[i]=function(){cb(arguments)}}),nt.parentNode.insertBefore(me,nt)})
      (window, document, 'script', 'https://abt.s3.yandex.net/expjs/latest/exp.js', 'ymab');
      ymab('metrika.105672115', 'init'/*, {clientFeatures}, {callback}*/);
    </script>

</head>

<body>

<button id="test-button-buy" style="font-size: 24px;">–ö—É–ø–∏—Ç—å</button>

<script>
  document.getElementById("test-button-buy").addEventListener("click", () => {
    ym(105672115,'reachGoal','click_button')
  });
</script>
<script>
  ymab('metrika.105672115', 'getFlags', function (flags) {
    console.log('Varioqub flags:', flags);

    if (flags.heading_text) {
      const h1 = document.createElement('h1');
      h1.innerText = flags.heading_text;
      document.body.prepend(h1);
    }

    if (flags.button_color) {
      const btn = document.getElementById('test-button-buy');
      btn.style.backgroundColor = flags.button_color;
      btn.style.color = 'white';
    }

    if (flags.show_discount === true) {
      const discount = document.createElement('div');
      discount.innerText = 'üî• –°–∫–∏–¥–∫–∞ 20%';
      discount.style.marginTop = '12px';
      discount.style.fontSize = '18px';
      discount.style.color = 'red';
      document.body.appendChild(discount);
    }
  });
</script>
<script>
    async function initExperiment() {
        try {
            const response = await fetch(`/experiment?url=${encodeURIComponent(window.location.href)}`);
            const data = await response.json();

            console.log('UserSplit flags:', data.flags);
            console.log('UserSplit experiments:', data.experiments);

            if (data.experiments) {
                ym(105672115, 'experiments', data.experiments);
            }

            const flags = {};
            data.flags.forEach(f => {
                flags[f.n] = f.v;
            });

            if (flags.heading_text) {
                const h1 = document.createElement('h1');
                h1.innerText = flags.heading_text;
                document.body.prepend(h1);
            }

            if (flags.button_color) {
                const btn = document.getElementById('test-button-buy');
                btn.style.backgroundColor = flags.button_color;
                btn.style.color = 'white';
            }

            if (flags.show_discount === true) {
                const discount = document.createElement('div');
                discount.innerText = 'üî• –°–∫–∏–¥–∫–∞ 20%';
                discount.style.marginTop = '12px';
                discount.style.fontSize = '18px';
                discount.style.color = 'red';
                document.body.appendChild(discount);
            }

        } catch (err) {
            console.error('Experiment init error', err);
        }
    }

    initExperiment();
</script>


</body>
</html>
